<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindLink - 持续清醒的第二大脑</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/css/style.css?v=20260104a">
</head>

<body>
    <div data-logic-id="app-container">
        <!-- 移动端遮罩层 -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <!-- Sidebar: Mind List -->
        <aside data-logic-id="sidebar">
            <nav data-logic-id="sidebar-header">
                <h1>MindLink</h1>
                <p>把想法变成可演化的记忆单元<br>把单元连接成第二大脑神经网络</p>
                <button id="createMindBtn" data-logic-id="create-mind-button">+ 新建 Mind</button>
            </nav>
            <section id="mindList" data-logic-id="mind-list">
                <!-- Dynamically populated Mind list -->
            </section>
            <div data-logic-id="sidebar-footer" class="sidebar-footer">
                <span id="currentUser" class="current-user"></span>
                <a href="/admin" id="adminLink" class="admin-link" style="display:none;">提示词管理</a>
                <button id="logoutBtn" class="logout-btn">退出登录</button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main data-logic-id="main-content">
            <!-- Empty State -->
            <section id="emptyState" data-logic-id="empty-state">
                <button id="emptyStateMenuBtn" class="empty-state-menu-btn">☰ 打开菜单</button>
                <div style="font-size: 64px; margin-bottom: 20px; opacity: 0.2;">✧</div>
                <h2>选择或创建一个 Mind</h2>
                <p>开始整理你的碎碎念与洞察</p>
            </section>

            <!-- Mind Detail View -->
            <section id="mindDetail" data-logic-id="mind-detail" style="display: none;">
                <header data-logic-id="detail-header">
                    <button id="mobileBackBtn" class="mobile-back-btn">← 返回</button>
                    <h2 id="mindTitle">Mind 标题</h2>
                </header>

                <!-- AI Generated Summary and Tags -->
                <div class="crystal-summary-area" id="summaryArea" style="display: none;">
                    <p id="aiBrief" class="ai-brief"></p>
                    <div class="summary-tag-cloud" id="tagCloud"></div>
                </div>

                <!-- Tab Navigation -->
                <nav data-logic-id="tabs">
                    <button data-tab="feed" data-logic-id="tab-feed">投喂</button>
                    <button data-tab="structure" data-logic-id="tab-structure">结构</button>
                    <button data-tab="timeline" data-logic-id="tab-timeline">时间轴</button>
                    <button data-tab="chat" data-logic-id="tab-chat">对话</button>
                    <button data-tab="narrative" data-logic-id="tab-narrative">叙事</button>
                    <button data-tab="output" data-logic-id="tab-output">输出</button>
                </nav>

                <!-- Tab 1: Feed (投喂) -->
                <section id="feedTab" data-logic-id="feed-tab-content">
                    <div data-logic-id="feed-input-area">
                        <textarea id="feedInput" data-logic-id="feed-input"
                            placeholder="想到什么写什么，AI 会自动去噪处理..."></textarea>
                        <button id="feedBtn" data-logic-id="feed-submit-button">记录思想</button>
                    </div>
                    <div id="feedStatus" data-logic-id="feed-status"></div>
                </section>

                <!-- Tab 2: Chat (对话) -->
                <section id="chatTab" data-logic-id="chat-tab-content" style="display: none;">
                    <header data-logic-id="chat-controls">
                        <select id="chatModel" data-logic-id="chat-model-select">
                            <option value="google_gemini_3_flash">Gemini 3 Flash</option>
                            <option value="google_gemini_3_pro">Gemini 3 Pro</option>
                            <option value="plato_gpt_5_2_chat">GPT-5.2 Plato</option>
                        </select>
                        <select id="chatStyle" data-logic-id="chat-style-select">
                            <option value="default">理性分析</option>
                            <option value="socratic">苏格拉底式</option>
                            <option value="creative">创意发散</option>
                        </select>
                        <button id="clearChatBtn" data-logic-id="chat-clear-button">刷新</button>
                    </header>
                    <div id="chatMessages" data-logic-id="chat-messages-container">
                        <div data-logic-id="chat-welcome">
                            <p>我已经了解了你关于这个主题的所有想法。</p>
                            <p>有什么想和我讨论的吗？</p>
                        </div>
                    </div>
                    <div data-logic-id="chat-input-area">
                        <textarea id="chatInput" data-logic-id="chat-input" placeholder="输入你想讨论的内容..."
                            rows="1"></textarea>
                        <button id="sendChatBtn" data-logic-id="chat-send-button">↑</button>
                    </div>
                </section>

                <!-- Tab 3: Timeline (时间轴) -->
                <section id="timelineTab" data-logic-id="timeline-tab-content" style="display: none;">
                    <header data-logic-id="timeline-header"
                        style="margin-bottom: 24px; color: var(--text-dim); font-size: 14px;">
                        去噪后的原始记录，按时间轴回溯
                    </header>
                    <div id="timelineContent" data-logic-id="timeline-content"></div>
                </section>

                <!-- Tab 4: Narrative (叙事) -->
                <section id="narrativeTab" data-logic-id="narrative-tab-content" style="display: none;">
                    <header data-logic-id="narrative-header" style="margin-bottom: 32px;">
                        <p style="color: var(--text-dim)">整合所有记录，生成连贯的思想叙事</p>
                        <button id="generateNarrativeBtn" data-logic-id="narrative-generate-button"
                            style="background: var(--bg-card); border: 1px solid var(--border); color: #fff; padding: 10px 20px; border-radius: 12px; cursor: pointer;">生成叙事</button>
                    </header>
                    <div id="narrativeContent" data-logic-id="narrative-content"></div>
                </section>

                <!-- Tab 5: Structure (结构) -->
                <section id="structureTab" data-logic-id="structure-tab-content" style="display: none;">
                    <header data-logic-id="structure-header" style="margin-bottom: 24px; color: var(--text-dim);">
                        提炼核心认知，结构化展示
                    </header>
                    <div id="structureContent" data-logic-id="structure-content"></div>
                </section>

                <!-- Tab 6: Output (输出) -->
                <section id="outputTab" data-logic-id="output-tab-content" style="display: none;">
                    <div data-logic-id="output-input-area" style="display: flex; gap: 12px; margin-bottom: 32px;">
                        <input type="text" id="outputInstruction" data-logic-id="output-instruction-input"
                            placeholder="例如：写一段给投资人看的说明"
                            style="flex: 1; background: var(--bg-card); border: 1px solid var(--border); color: #fff; padding: 14px; border-radius: 12px;">
                        <button id="outputBtn" data-logic-id="output-generate-button"
                            style="background: var(--primary); color: var(--bg-deep); border: none; padding: 0 24px; border-radius: 12px; font-weight: bold; cursor: pointer;">生成</button>
                    </div>
                    <div id="outputResult" data-logic-id="output-result"></div>
                </section>
            </section>
        </main>
    </div>

    <!-- Modal: Create Mind -->
    <dialog id="createMindModal" data-logic-id="create-mind-modal">
        <div data-logic-id="modal-content">
            <h3 style="margin-top: 0;">创建新的 Mind</h3>
            <p style="font-size: 13px; color: var(--text-dim);">为一个新的话题、项目或思考方向命名</p>
            <input type="text" id="newMindTitle" data-logic-id="new-mind-title-input" placeholder="例如：我的 2024 产品观">
            <div data-logic-id="modal-actions">
                <button id="modalCancelBtn" data-logic-id="modal-cancel-button">取消</button>
                <button id="modalCreateBtn" data-logic-id="modal-create-button">创建档案</button>
            </div>
        </div>
    </dialog>

    <!-- Modal: Edit Feed -->
    <dialog id="editFeedModal" data-logic-id="edit-feed-modal">
        <div data-logic-id="modal-content">
            <h3 style="margin-top: 0;">编辑记录</h3>
            <input type="hidden" id="editFeedId">
            <textarea id="editFeedContent" data-logic-id="edit-feed-content" rows="5" placeholder="输入内容..."></textarea>
            <div data-logic-id="modal-actions">
                <button onclick="document.getElementById('editFeedModal').close()">取消</button>
                <button onclick="saveTimelineEdit()" id="editSaveBtn" style="background: var(--primary); color: var(--bg-deep);">保存</button>
            </div>
        </div>
    </dialog>

    <script src="/static/js/app.js?v=20260104b"></script>
</body>

</html>