# MindLink 历史教训档案

> 把踩过的坑变成可复用的教训，避免重复犯错。
> 本文档由 debug agent 自动查阅和更新。

**文档维护声明**：本文档可以修改。如果发现内容过时或已解决，应移到"已解决"区域或删除。保持精简。

---

## 活跃教训（当前仍需注意）

### [2026-01] 多端 ID 必须同步
**关键词**：前端、移动端、ID、element、不工作
**现象**：移动端某功能不工作，桌面端正常
**原因**：桌面端改了元素 ID，移动端没同步
**教训**：改前端时必须检查两端 ID 一致性
**状态**：活跃

---

### [2026-01] 提示词必须通过 get_prompt() 获取
**关键词**：提示词、prompt、硬编码、没生效
**现象**：后台改了提示词但没生效
**原因**：代码里硬编码了提示词，没走 `get_prompt()`
**教训**：所有提示词必须通过 `api/prompts.py` 的 `get_prompt()` 获取
**状态**：活跃

---

### [2026-01] 不要修改 ai_hub 代码
**关键词**：ai_hub、AI调用、异常
**现象**：AI 调用行为异常
**原因**：误改了 `/root/ai_hub` 的代码
**教训**：MindLink 只是 AI Hub 的调用方，绝对不修改 ai_hub 代码
**状态**：活跃

---

### [2026-01] Crystal 字段名统一
**关键词**：Crystal、字段、pending、为空
**现象**：前端显示待定事项为空
**原因**：后端用了 `pending_questions`，前端期望 `pending_notes`
**教训**：统一使用 `pending_notes`，不要使用 `pending_questions`
**状态**：活跃

---

### [2026-01] 配置必须集中管理
**关键词**：配置、config、没生效、重复定义
**现象**：改了配置但部分功能没生效
**原因**：配置在多个文件中重复定义
**教训**：所有配置集中在 `api/config.py`，其他文件从这里导入
**状态**：活跃

---

### [2026-01] ISO 时间格式解析需显式处理
**关键词**：时间、datetime、fromisoformat、解析失败
**现象**：时间字符串 `2026-01-02T06:40` 解析失败，fallback 到当前时间
**原因**：`datetime.fromisoformat()` 对无秒的 ISO 格式支持不稳定
**教训**：用 `strptime(time_str, "%Y-%m-%dT%H:%M")` 显式解析，不依赖 fromisoformat
**状态**：活跃

---

## 已解决（仅供参考）

*（暂无已解决的历史问题）*

---

## 维护规则

1. **新增**：出现新的踩坑，立即记录到"活跃教训"
2. **格式**：每条教训包含 现象/原因/教训/状态
3. **清理**：已根本解决的问题，移到"已解决"区域
4. **精简**：每条教训控制在 5 行以内

---

**最后更新**: 2026-01-09
