# MindLink 产品架构文档

> 本文档定义 MindLink 的核心数据架构和处理逻辑

---

## 核心理念

MindLink 是一个**记录、整理、迭代、输出**的思想管理工具。

核心原则：
- AI 是编辑器，不是作者
- 保留原意是第一优先级
- 压缩是为了清晰，不是为了省空间

---

## 三层内容体系

用户的思想通过三层递进压缩，适应不同场景：

```
用户输入（原始内容）
        ↓
【第一层】时间轴记录（去噪原文）
        ↓
【第二层】叙事视图（整体梳理）
        ↓
【第三层】结构视图（提炼思想）
```

### 第一层：时间轴记录

**定位**：去噪后的底层材料，保留原意的压缩版

**处理规则**：
- 去除噪声：语气词、重复内容、冗余表达
- 保留原意：观点、情绪、细节、比喻、例子
- 整顿用语：修正用词、简洁表达
- 允许大幅压缩（3000字→500字都OK，只要不丢原意）

**时间单位**：
- 当天：按投喂时间段显示（如 10:30、14:20）
- 历史：按天合并显示（如 2025-12-28）

**用途**：
- 用户查阅底层思想
- 输出功能的源材料（基于此生成各种表达）

### 第二层：叙事视图

**定位**：整体思想的梳理汇总，体现时间演变

**处理规则**：
- 读取所有时间轴记录
- 合并、更新、迭代内容
- 整顿逻辑，形成连贯叙事
- 体现时间感（思想演变、推翻、迭代过程）
- 可在第一层基础上再压缩

**特点**：
- 消耗上下文最多（需要全量时间线）
- 按需生成（用户点击时触发）
- 清晰表达中心思想和心理历程

### 第三层：结构视图

**定位**：去除情绪的核心提炼

**处理规则**：
- 提炼核心观点和认知
- 去除情绪性表达
- 围绕主题结构化

**内容字段**：
- core_goal: 核心目标
- current_knowledge: 当前认知
- highlights: 亮点创意
- pending_notes: 待定事项
- evolution: 演变记录

**衍生**：
- 思维导图：基于结构视图生成

---

## 模型调用策略

### 调用时机

| 场景 | 调用内容 | 触发方式 |
|------|----------|----------|
| 用户投喂 | 第一层（去噪）+ 第三层（结构更新） | 自动 |
| 查看叙事视图 | 第二层（整体梳理） | 手动点击 |
| 查看导图 | 基于第三层生成 | 手动点击 |
| 输出内容 | 基于第一层生成 | 手动输入指令 |

### 优化原则

1. **合并调用**：投喂时，一次调用同时输出去噪记录和结构更新
2. **按需生成**：叙事视图消耗大，用户需要时才生成
3. **程序优先**：能用程序处理的不用模型（如时间合并逻辑）

---

## 数据存储结构

### feed_items 表（投喂记录）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | TEXT | 投喂ID |
| mind_id | TEXT | 所属Mind |
| content | TEXT | 原始内容 |
| cleaned_content | TEXT | **去噪后内容（新增）** |
| created_at | TEXT | 创建时间 |

### minds 表（Mind主体）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | TEXT | Mind ID |
| title | TEXT | 标题 |
| crystal_json | TEXT | 第三层结构数据 |
| narrative_cache | TEXT | **第二层缓存（新增，可选）** |
| created_at | TEXT | 创建时间 |
| updated_at | TEXT | 更新时间 |

---

## 显示逻辑

### 时间轴视图（新增）

显示去噪后的时间轴记录：

```
2025-12-28
├── 10:30  [去噪后的内容片段1]
├── 14:20  [去噪后的内容片段2]
└── 18:45  [去噪后的内容片段3]

2025-12-27
└── [当天合并的内容]

2025-12-26
└── [当天合并的内容]
```

### 叙事视图

点击生成，显示整体梳理结果。

### 结构视图

显示提炼后的结构化内容。

---

## 输出逻辑

输出功能基于**第一层（去噪记录）**生成，不是基于压缩后的结构。

这样确保输出内容保留了用户的原始意图和细节。

---

## 待定事项

1. **模板灵活性**：不同类型的 Mind 是否需要不同的结构模板（后续考虑）
2. **叙事视图缓存**：是否缓存上次生成结果，避免重复计算
3. **时间轴合并规则**：跨天合并的具体逻辑细节

---

**文档版本**: v1.0
**最后更新**: 2025-12-28
